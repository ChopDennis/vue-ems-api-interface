(function(t){function e(e){for(var s,r,n=e[0],l=e[1],c=e[2],d=0,u=[];d<n.length;d++)r=n[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&u.push(o[r][0]),o[r]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);p&&p(e);while(u.length)u.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],s=!0,n=1;n<a.length;n++){var l=a[n];0!==o[l]&&(s=!1)}s&&(i.splice(e--,1),t=r(r.s=a[0]))}return t}var s={},o={app:0},i=[];function r(e){if(s[e])return s[e].exports;var a=s[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=s,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(a,s,function(e){return t[e]}.bind(null,s));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=e,n=n.slice();for(var c=0;c<n.length;c++)e(n[c]);var p=l;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},3079:function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("c975"),a("ac1f"),a("1276"),a("e260"),a("e6cf"),a("cca6"),a("a79d");var s=a("2b0e"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view",{attrs:{name:"nav"}}),a("router-view")],1)},i=[],r=(a("5c0b"),a("2877")),n={},l=Object(r["a"])(n,o,i,!1,null,null,null),c=l.exports,p=a("8c4f"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"text-white",attrs:{id:"ems-login-page"}},[a("b-container",{staticClass:"my-5 p-3",attrs:{id:"ems-login-container"}},[a("b-card",{staticClass:"mb-3 px-md-5",attrs:{"bg-variant":"dark"}},[a("h2",{staticClass:"text-center mb-3"},[t._v(" 登入 EMS 系統 ")]),a("b-form-group",{attrs:{"label-cols-sm":"3",label:"輸入信箱：","label-align-sm":"right","label-for":"ems-email"}},[a("b-form-input",{attrs:{id:"ems-email",type:"email",required:""},model:{value:t.input.email,callback:function(e){t.$set(t.input,"email",e)},expression:"input.email"}})],1),a("b-form-group",{attrs:{"label-cols-sm":"3",label:"輸入密碼：","label-align-sm":"right","label-for":"ems-password"}},[a("b-form-input",{attrs:{id:"ems-email",type:"password",required:""},model:{value:t.input.password,callback:function(e){t.$set(t.input,"password",e)},expression:"input.password"}})],1),a("b-button",{staticClass:"d-block m-auto",attrs:{type:"submit"},on:{click:function(e){return t.loginEMS()}}},[t._v(" 登入 ")])],1),a("b-alert",{staticClass:"text-center",attrs:{show:t.alert,variant:"success",fade:""}},[t._v(" 登入成功！ ")])],1)],1)},u=[],m={name:"PageLogin",data:function(){return{input:{email:"",password:""},alert:!1}},methods:{loginEMS:function(){var t=this,e=this.$store.state.axios.baseURL+"/api/user/login",a=1500;this.axios.post(e,this.input).then((function(e){200===e.status?(t.alert=!0,document.cookie="login=true;",setTimeout((function(){t.$router.push("/real-time")}),a)):alert("伺服器回傳錯誤代碼："+e.status)})).catch((function(t){alert(t+"登入失敗，帳號或密碼錯誤")}))}}},f=m,h=(a("5960"),Object(r["a"])(f,d,u,!1,null,"e49c97e6",null)),v=h.exports,b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-container",{staticClass:"py-3 text-white"},[a("h4",{staticClass:"text-center mb-3"},[t._v("即時用電需量")]),a("RealTimeInputForm",{on:{"get-responded-data":t.preprocessData}}),a("RealTimeDashBoard",{attrs:{"output-data":t.output}}),a("h4",{staticClass:"text-center mt-3"},[t._v("即時需量變化表（每一分鐘更新）")]),a("apexchart",{ref:"ApexLine",staticClass:"mt-3",attrs:{id:"apex-chart",type:"line",height:t.apex.height,options:t.apex.chartOptions,series:t.apex.series}})],1)],1)},_=[],x=(a("4160"),a("a9e3"),a("c35a"),a("b680"),a("159b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-card",{staticClass:"mb-5 px-lg-5",attrs:{"bg-variant":"dark"}},[a("b-form",{on:{submit:t.onSubmit}},[a("b-form-group",{attrs:{"label-cols-sm":"3",label:"電錶號碼：","label-align-sm":"right","label-for":"real-time-place-id"}},[t.admin?a("b-form-input",{attrs:{id:"real-time-place-id",type:"text",placeholder:"輸入電錶號碼"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}}):a("b-form-select",{attrs:{id:"real-time-place-id"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇電錶號碼 ")]),t._l(t.options.place_id,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1),t.admin?a("b-form-group",{attrs:{"label-cols-sm":"3",label:"伺服器位置：","label-align-sm":"right","label-for":"real-time-server-ip"}},[a("b-form-select",{attrs:{id:"real-time-server-ip"},model:{value:t.selected.server_ip,callback:function(e){t.$set(t.selected,"server_ip",e)},expression:"selected.server_ip"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇伺服器 ")]),t._l(t.options.server_ip,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1):t._e(),a("b-button",{staticClass:"m-auto d-block",attrs:{type:"submit"}},[t._v(" 送出查詢資料 ")])],1)],1)],1)}),g=[],A={name:"RealTimeInputForm",data:function(){return{admin:!1,options:{place_id:Object,server_ip:{"195 商辦":"db4.ima-ems.com","196 非商辦":"db2.ima-ems.com"}},selected:{place_id:"",server_ip:""},get:{params:Object}}},created:function(){var t=this,e=this.$store.state.axios.baseURL+"/api/user/lists";this.axios.get(e).then((function(e){t.admin=1===e.data.permission,t.options.place_id=Object.assign({},e.data.places)}))},methods:{onSubmit:function(t){t.preventDefault(),this.getRealTimeData()},getRealTimeData:function(){var t=this;this.get.params=this.selected,this.axios.get(this.$store.state.axios.baseURL+"/api/realtime",this.get).then((function(e){t.$store.commit("setRealTimeData",e.data),t.$emit("get-responded-data")}))}}},y=A,D=Object(r["a"])(y,x,g,!1,null,"61065d99",null),C=D.exports,k=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row",staticStyle:{"background-color":"rgba(29,27,65,.6)","border-radius":"7px",padding:"1rem 0",margin:"0"}},[s("div",{staticClass:"col-lg-3 offset-lg-1 col-md-12 text-center py-3"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg-12 col-6"},[s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[5].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[5].value)+" ")])]),s("div",{staticClass:"col-lg-12 col-6"},[s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[2].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[2].value)+" ")])])]),s("img",{staticStyle:{padding:"2rem",width:"200px"},attrs:{src:a("741b")}})]),s("div",{staticClass:"col-lg-7 col-md-12 text-center"},[s("div",{staticClass:"row py-3",staticStyle:{"background-color":"hsla(0, 0%, 100%, .13)",margin:"0","border-radius":"7px"}},[s("div",{staticClass:"col-4"},[s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[0].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[0].value)+" ")]),s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[8].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[8].value)+" ")])]),s("div",{staticClass:"col-4"},[s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[1].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[1].value)+" ")]),s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[9].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[9].value)+" ")])]),s("div",{staticClass:"col-4"},[s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[11].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[11].value)+" ")]),s("p",{staticClass:"real-time-title"},[t._v(" "+t._s(t.outputData.lists[10].name)+" ")]),s("p",{staticClass:"real-time-value"},[t._v(" "+t._s(t.outputData.lists[10].value)+" ")])])]),s("div",{staticClass:"row p-3"},[s("div",{staticClass:"col-4"},[s("p",{staticStyle:{"font-size":"14px",color:"darkgrey"}},[t._v(" "+t._s(t.outputData.lists[3].name)+" ")]),s("p",{staticStyle:{"font-weight":"bold","font-size":"12px",color:"white"}},[t._v(" "+t._s(t.outputData.lists[3].value)+" ")])]),s("div",{staticClass:"col-4"},[s("p",{staticStyle:{"font-size":"14px",color:"darkgrey"}},[t._v(" "+t._s(t.outputData.lists[4].name)+" ")]),s("p",{staticStyle:{"font-weight":"bold","font-size":"12px",color:"white"}},[t._v(" "+t._s(t.outputData.lists[4].value)+" ")])]),s("div",{staticClass:"col-4"},[s("p",{staticStyle:{"font-size":"14px",color:"darkgrey"}},[t._v(" "+t._s(t.outputData.lists[7].name)+" ")]),s("p",{staticStyle:{"font-weight":"bold","font-size":"12px",color:"white"}},[t._v(" "+t._s(t.outputData.lists[7].value)+" ")])])])])])},w=[],E={name:"RealTimeDashBoard",props:{outputData:{type:Object,default:function(){return{}}}}},O=E,M=Object(r["a"])(O,k,w,!1,null,"69e39426",null),z=M.exports,S={name:"PageRealTime",components:{RealTimeInputForm:C,RealTimeDashBoard:z},data:function(){return{admin:!1,apex:{height:500,chartOptions:{chart:{foreColor:"#f5f5f5",toolbar:{show:!1}},dataLabels:{enabled:!1},noData:{text:"等待輸入資料..."},xaxis:{type:"datetime",labels:{format:"HH:mm"}},tooltip:{x:{format:"HH:mm"}}},series:[{data:[]}]},output:{dateTime:"",countdown:60,lists:[{id:1,name:"電壓（V）",value:""},{id:2,name:"電流（A）",value:""},{id:3,name:"需量（kW）",value:""},{id:4,name:"視在功率（kVA）",value:""},{id:5,name:"無功功率（kVAR）",value:""},{id:6,name:"總用電度數（kWh）",value:""},{id:7,name:"視在電度數（kVAh）",value:""},{id:8,name:"無功電度數（kVARh）",value:""},{id:9,name:"三相電流－Ａ（A）",value:""},{id:10,name:"三相電流－Ｂ（A）",value:""},{id:11,name:"三相電流－Ｃ（A）",value:""},{id:12,name:"功率因數",value:""},{id:13,name:"用電狀態",value:""}]}}},methods:{preprocessData:function(){var t=this,e=this.$store.getters.RespondedRealTimeData;if("success"===e.status){var a=e.data[1];a.forEach((function(e,a){0===a?t.output.dateTime=e:t.output.lists[a-1].value="None"!==e&&12!==a?Number.parseFloat(e).toFixed(1):e}))}this.setApexLine()},setApexLine:function(){var t=(new Date).getTime();this.$refs.ApexLine.appendData([{data:[[t+288e5,this.output.lists[2].value]]}])}}},j=S,F=Object(r["a"])(j,b,_,!1,null,"013c39c2",null),P=F.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-container",{staticClass:"py-3 text-white"},[a("h4",{staticClass:"text-center mb-3"},[t._v("每日用電熱圖")]),a("HeatmapInputForm",{on:{"get-responded-data":t.preprocessData}}),a("b-button",{staticClass:"d-block m-auto"},[a("a",{staticStyle:{color:"white!important"},attrs:{href:t.output.csv.href,download:t.output.csv.fileName}},[t._v("下載表格資料")])]),a("div",{staticClass:"mt-3 text-dark"},[a("apexchart",{ref:"heatmap",attrs:{height:t.apex.height,type:"heatmap",options:t.apex.chartOptions,series:t.apex.series}})],1)],1)],1)},R=[],U=(a("13d5"),a("fb6a"),a("b0c0"),a("d3b7"),a("25f0"),a("5319"),a("2909")),H=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-card",{staticClass:"mb-5 px-lg-5",attrs:{"bg-variant":"dark"}},[a("b-form",{on:{submit:t.onSubmit}},[a("b-form-group",{attrs:{"label-cols-sm":"3",label:"電錶號碼：","label-align-sm":"right","label-for":"heatmap-place-id"}},[t.admin?a("b-form-input",{attrs:{id:"heatmap-place-id",type:"text",placeholder:"輸入電錶號碼"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}}):a("b-form-select",{attrs:{id:"heatmap-place-id"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇電錶號碼 ")]),t._l(t.options.place_id,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1),t.admin?a("b-form-group",{attrs:{"label-cols-sm":"3",label:"伺服器位置：","label-align-sm":"right","label-for":"heatmap-server-ip"}},[a("b-form-select",{attrs:{id:"heatmap-server-ip"},model:{value:t.selected.server_ip,callback:function(e){t.$set(t.selected,"server_ip",e)},expression:"selected.server_ip"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇伺服器 ")]),t._l(t.options.server_ip,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1):t._e(),a("b-form-group",{attrs:{"label-cols-sm":"3",label:"日期：","label-align-sm":"right","label-for":"heatmap-date"}},[a("b-form-input",{attrs:{id:"heatmap-date",type:"date"},model:{value:t.selected.date,callback:function(e){t.$set(t.selected,"date",e)},expression:"selected.date"}})],1),a("b-form-group",{attrs:{"label-cols-sm":"3",label:"顯示天數：","label-align-sm":"right","label-for":"heatmap-days"}},[a("b-form-select",{attrs:{id:"heatmap-days"},model:{value:t.selected.days,callback:function(e){t.$set(t.selected,"days",e)},expression:"selected.days"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇顯示天數 ")]),t._l(31,(function(e){return a("option",{key:e},[t._v(" "+t._s(e)+" ")])}))],2)],1),a("b-button",{staticClass:"m-auto d-block",attrs:{type:"submit"}},[t._v(" 送出查詢資料 ")])],1)],1)],1)},B=[],Q={name:"HeatmapInputForm",data:function(){return{admin:!1,options:{place_id:Object,server_ip:{"195 商辦":"db4.ima-ems.com","196 非商辦":"db2.ima-ems.com"}},selected:{place_id:"",server_ip:"",date:"",days:""},get:{params:Object}}},created:function(){var t=this,e=this.$store.state.axios.baseURL+"/api/user/lists";this.axios.get(e).then((function(e){t.admin=1===e.data.permission,t.options.place_id=Object.assign({},e.data.places)}))},methods:{onSubmit:function(t){var e=this;t.preventDefault();var a=new FormData;a.append("device_id",this.selected.place_id),a.append("check_day",this.selected.date),a.append("days",this.selected.days),a.append("server_ip",this.selected.server_ip),this.axios.post(this.$store.state.axios.baseURL+"/api/analytic/kwh_summary",a).then((function(t){e.$store.commit("setHeatmapData",t.data),e.$emit("get-responded-data")}))}}},$=Q,N=Object(r["a"])($,H,B,!1,null,"0c4c9564",null),X=N.exports,L={name:"PageHeatmap",components:{HeatmapInputForm:X},data:function(){return{apex:{height:window.innerHeight-100,chartOptions:{chart:{foreColor:"#f5f5f5",toolbar:{show:!1}},dataLabels:{dropShadow:{enabled:!1},enabled:!1},noData:{text:"等待輸入資料..."}},series:[]},output:{total_of_day:0,csv:{href:"",fileName:"",header:"data:text/csv;charset=utf-8,%EF%BB%BF",content:""}}}},methods:{preprocessData:function(){var t=this.$store.getters.RespondedHeatmapData,e=this.sumTotal(t);this.modifyName(t,e),this.showHeatmap(t),this.outputCSV(t)},modifyName:function(t,e){t.forEach((function(t,a){t.name=t.name.replace("2020-",""),t.name+="（"+e[a]+"）"}))},sumTotal:function(t){var e=[],a=function(t,e){return t+e};return t.forEach((function(t,s){e[s]=parseInt(t.data.reduce(a).toFixed(0))})),this.output.total_of_day=e.reduce(a),e},showHeatmap:function(t){var e=this.findMaximum(t),a=this.findMinimum(t),s=Math.ceil(e),o=Math.floor(a),i=this.setPercent(s,o),r=!1;window.innerWidth>991&&(r=!0),this.apex.chartOptions={plotOptions:{heatmap:{colorScale:{ranges:[{from:o,to:i[1]-.1,color:this.percent2color(10)},{from:i[1],to:i[2]-.1,color:this.percent2color(20)},{from:i[2],to:i[3]-.1,color:this.percent2color(30)},{from:i[3],to:i[4]-.1,color:this.percent2color(40)},{from:i[4],to:i[5]-.1,color:this.percent2color(50)},{from:i[5],to:i[6]-.1,color:this.percent2color(60)},{from:i[6],to:i[7]-.1,color:this.percent2color(70)},{from:i[7],to:i[8]-.1,color:this.percent2color(80)},{from:i[8],to:i[9]-.1,color:this.percent2color(90)},{from:i[9],to:s,color:this.percent2color(100)}]}}},dataLabels:{enabled:r},xaxis:{type:"category",categories:["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"]}},this.apex.series=t},findMaximum:function(t){var e=[];return t.forEach((function(t){e.push(Math.max.apply(Math,Object(U["a"])(t.data)))})),Math.max.apply(Math,e)},findMinimum:function(t){var e=[];return t.forEach((function(t){e.push(Math.min.apply(Math,Object(U["a"])(t.data)))})),Math.min.apply(Math,e)},setPercent:function(t,e){for(var a=[],s=Math.floor((t-e)/10),o=1,i=1;o<10;o++)a[o]=e+s*i++;return a},percent2color:function(t){var e,a,s=0;t<40?(a=180,e=Math.round(5.1*t)):t>=40&&t<=50?(a=225,e=Math.round(2*t+155)):(e=255,a=Math.round(510-5.1*t));var o=65536*e+256*a+1*s;return"#"+("000000"+o.toString(16)).slice(-6)},outputCSV:function(t){var e=this,a="";this.output.csv.fileName="heatmap-",t.forEach((function(t){e.output.csv.content+="日期（總度數）,"+t.name+"\r\n時間,度數\r\n",t.data.forEach((function(t,a){e.output.csv.content+=e.apex.chartOptions.xaxis.categories[a]+","+t+"\r\n"})),a=encodeURI(e.output.csv.content)})),this.output.csv.href=this.output.csv.header+a}}},I=L,V=Object(r["a"])(I,T,R,!1,null,"3e90fda8",null),W=V.exports,G=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-container",{staticClass:"py-3 text-white"},[a("h4",{staticClass:"text-center mb-3"},[t._v("每十五分鐘需量")]),a("DemandInputForm",{on:{"get-responded-data":t.preprocessData}}),a("b-button",{staticClass:"d-block m-auto"},[a("a",{staticStyle:{color:"white!important"},attrs:{href:t.output.csv.href,download:t.output.csv.fileName}},[t._v("下載表格資料")])]),a("div",{staticClass:"mt-3 text-dark"},[a("apexchart",{ref:"area",attrs:{height:t.apex.height,type:"area",options:t.apex.chartOptions,series:t.apex.series}})],1)],1)],1)},Z=[],J=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-card",{staticClass:"mb-5 px-lg-5",attrs:{"bg-variant":"dark"}},[a("b-form",{on:{submit:t.onSubmit}},[a("b-form-group",{attrs:{"label-cols-sm":"3",label:"電錶號碼：","label-align-sm":"right","label-for":"demand-place-id"}},[t.admin?a("b-form-input",{attrs:{id:"demand-place-id",type:"text",placeholder:"輸入電錶號碼"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}}):a("b-form-select",{attrs:{id:"demand-place-id"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇電錶號碼 ")]),t._l(t.options.place_id,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1),t.admin?a("b-form-group",{attrs:{"label-cols-sm":"3",label:"伺服器位置：","label-align-sm":"right","label-for":"demand-server-ip"}},[a("b-form-select",{attrs:{id:"demand-server-ip"},model:{value:t.selected.server_ip,callback:function(e){t.$set(t.selected,"server_ip",e)},expression:"selected.server_ip"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇伺服器 ")]),t._l(t.options.server_ip,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1):t._e(),a("b-form-group",{attrs:{"label-cols-sm":"3",label:"日期：","label-align-sm":"right","label-for":"demand-date"}},[a("b-form-input",{attrs:{id:"demand-date",type:"date"},model:{value:t.selected.date,callback:function(e){t.$set(t.selected,"date",e)},expression:"selected.date"}})],1),a("b-button",{staticClass:"m-auto d-block",attrs:{type:"submit"}},[t._v(" 送出查詢資料 ")])],1)],1)],1)},q=[],K={name:"DemandInputForm",data:function(){return{admin:!1,options:{place_id:Object,server_ip:{"195 商辦":"db4.ima-ems.com","196 非商辦":"db2.ima-ems.com"}},selected:{place_id:"",server_ip:"",date:""}}},created:function(){var t=this,e=this.$store.state.axios.baseURL+"/api/user/lists";this.axios.get(e).then((function(e){t.admin=1===e.data.permission,t.options.place_id=Object.assign({},e.data.places)}))},methods:{onSubmit:function(t){var e=this;t.preventDefault();var a=new FormData;a.append("device_id",this.selected.place_id),a.append("check_day",this.selected.date),a.append("server_ip",this.selected.server_ip),this.axios.post(this.$store.state.axios.baseURL+"/api/analytic/kw_summary",a).then((function(t){e.$store.commit("setDemandData",t.data),e.$store.commit("setSelectedDate",e.selected.date),e.$emit("get-responded-data")}))}}},Y=K,tt=Object(r["a"])(Y,J,q,!1,null,"4e53d320",null),et=tt.exports,at={name:"PageFifteenDemand",components:{DemandInputForm:et},data:function(){return{apex:{height:window.innerHeight-200,chartOptions:{chart:{foreColor:"#f5f5f5",zoom:{zoomedArea:{fill:{color:"#831b49",opacity:1}}},toolbar:{show:!1}},dataLabels:{enabled:!1},noData:{text:"等待輸入資料..."},xaxis:{type:"datetime",labels:{format:"HH:mm"}},tooltip:{x:{format:"HH:mm"}}},series:[]},output:{csv:{href:"",fileName:"",header:"data:text/csv;charset=utf-8,%EF%BB%BF",content:""}}}},methods:{preprocessData:function(){var t=this.$store.getters.RespondedDemandData;console.log(t);var e=this.addTime2xAxis(t);this.apex.series=[{name:this.$store.state.selected.date,data:e}],this.outputCSV(e)},addTime2xAxis:function(t){var e=new Date(this.$store.state.selected.date).getTime(),a=[];return t.data.forEach((function(t,s){a[s]=[],a[s].push(e,Number.parseFloat(t).toFixed(1)),e+=9e5})),a},outputCSV:function(t){var e=this,a="";this.output.csv.fileName="kw-"+this.$store.state.selected.date+".csv",this.output.csv.content+="日期,"+this.$store.state.selected.date+"\r\n時間,需量\r\n",t.forEach((function(t){var s=e.timestamp2String(t[0])+","+t[1];e.output.csv.content+=s+"\r\n",a=encodeURI(e.output.csv.content)})),this.output.csv.href=this.output.csv.header+a},timestamp2String:function(t){var e=new Date;e.setTime(t);var a=e.getUTCHours(),s=e.getUTCMinutes(),o=0===s?"0":"";return a+":"+s+o}}},st=at,ot=Object(r["a"])(st,G,Z,!1,null,"6a923d40",null),it=ot.exports,rt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-container",{staticClass:"py-3 text-white"},[a("h4",{staticClass:"text-center mb-3"},[t._v("每小時最高需量")]),a("HourDemandInputForm",{on:{"get-responded-data":t.preprocessData}}),a("b-button",{staticClass:"d-block m-auto"},[a("a",{staticStyle:{color:"white!important"},attrs:{href:t.output.csv.href,download:t.output.csv.fileName}},[t._v("下載表格資料")])]),a("div",{staticClass:"mt-3 text-dark"},[a("apexchart",{ref:"heatmap",attrs:{height:t.apex.height,type:"heatmap",options:t.apex.chartOptions,series:t.apex.series}})],1)],1)],1)},nt=[],lt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-card",{staticClass:"mb-5 px-lg-5",attrs:{"bg-variant":"dark"}},[a("b-form",{on:{submit:t.onSubmit}},[a("b-form-group",{attrs:{"label-cols-sm":"3",label:"電錶號碼：","label-align-sm":"right","label-for":"heatmap-place-id"}},[t.admin?a("b-form-input",{attrs:{id:"heatmap-place-id",type:"text",placeholder:"輸入電錶號碼"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}}):a("b-form-select",{attrs:{id:"heatmap-place-id"},model:{value:t.selected.place_id,callback:function(e){t.$set(t.selected,"place_id",e)},expression:"selected.place_id"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇電錶號碼 ")]),t._l(t.options.place_id,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1),t.admin?a("b-form-group",{attrs:{"label-cols-sm":"3",label:"伺服器位置：","label-align-sm":"right","label-for":"heatmap-server-ip"}},[a("b-form-select",{attrs:{id:"heatmap-server-ip"},model:{value:t.selected.server_ip,callback:function(e){t.$set(t.selected,"server_ip",e)},expression:"selected.server_ip"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇伺服器 ")]),t._l(t.options.server_ip,(function(e,s){return a("option",{key:s,domProps:{value:e}},[t._v(" "+t._s(s)+" ")])}))],2)],1):t._e(),a("b-form-group",{attrs:{"label-cols-sm":"3",label:"日期：","label-align-sm":"right","label-for":"heatmap-date"}},[a("b-form-input",{attrs:{id:"heatmap-date",type:"date"},model:{value:t.selected.date,callback:function(e){t.$set(t.selected,"date",e)},expression:"selected.date"}})],1),a("b-form-group",{attrs:{"label-cols-sm":"3",label:"顯示天數：","label-align-sm":"right","label-for":"heatmap-days"}},[a("b-form-select",{attrs:{id:"heatmap-days"},model:{value:t.selected.days,callback:function(e){t.$set(t.selected,"days",e)},expression:"selected.days"}},[a("option",{attrs:{value:"",disabled:"",selected:""}},[t._v(" 選擇顯示天數 ")]),t._l(31,(function(e){return a("option",{key:e},[t._v(" "+t._s(e)+" ")])}))],2)],1),a("b-button",{staticClass:"m-auto d-block",attrs:{type:"submit"}},[t._v(" 送出查詢資料 ")])],1)],1)],1)},ct=[],pt={name:"HeatmapInputForm",data:function(){return{admin:!1,options:{place_id:Object,server_ip:{"195 商辦":"db4.ima-ems.com","196 非商辦":"db2.ima-ems.com"}},selected:{place_id:"",server_ip:"",date:"",days:""},get:{params:Object}}},created:function(){var t=this,e=this.$store.state.axios.baseURL+"/api/user/lists";this.axios.get(e).then((function(e){t.admin=1===e.data.permission,t.options.place_id=Object.assign({},e.data.places)}))},methods:{onSubmit:function(t){var e=this;t.preventDefault();var a=new FormData;a.append("device_id",this.selected.place_id),a.append("check_day",this.selected.date),a.append("days",this.selected.days),a.append("server_ip",this.selected.server_ip),this.axios.post(this.$store.state.axios.baseURL+"/api/analytic/kw_summary/range",a).then((function(t){e.$store.commit("setHeatmapData",t.data),e.$emit("get-responded-data")}))}}},dt=pt,ut=Object(r["a"])(dt,lt,ct,!1,null,"dba00c7c",null),mt=ut.exports,ft={name:"PageHourDemanf",components:{HourDemandInputForm:mt},data:function(){return{apex:{height:window.innerHeight-100,chartOptions:{chart:{foreColor:"#f5f5f5",toolbar:{show:!1}},dataLabels:{enabled:!1},noData:{text:"等待輸入資料..."}},series:[]},output:{total_of_day:0,csv:{href:"",fileName:"",header:"data:text/csv;charset=utf-8,%EF%BB%BF",content:""}}}},methods:{preprocessData:function(){var t=this.$store.getters.RespondedHeatmapData,e=this.sumTotal(t);this.modifyName(t,e),this.showHeatmap(t),this.outputCSV(t)},modifyName:function(t,e){t.forEach((function(t,a){t.name=t.name.replace("2020-",""),t.name+="（"+e[a]+"）"}))},sumTotal:function(t){var e=[],a=function(t,e){return t+e};return t.forEach((function(t,s){e[s]=parseInt(t.data.reduce(a).toFixed(0))})),this.output.total_of_day=e.reduce(a),e},showHeatmap:function(t){var e=this.findMaximum(t),a=this.findMinimum(t),s=Math.ceil(e),o=Math.floor(a),i=this.setPercent(s,o),r=!1;window.innerWidth>991&&(r=!0),this.apex.chartOptions={plotOptions:{heatmap:{colorScale:{ranges:[{from:o,to:i[1]-.1,color:this.percent2color(10)},{from:i[1],to:i[2]-.1,color:this.percent2color(20)},{from:i[2],to:i[3]-.1,color:this.percent2color(30)},{from:i[3],to:i[4]-.1,color:this.percent2color(40)},{from:i[4],to:i[5]-.1,color:this.percent2color(50)},{from:i[5],to:i[6]-.1,color:this.percent2color(60)},{from:i[6],to:i[7]-.1,color:this.percent2color(70)},{from:i[7],to:i[8]-.1,color:this.percent2color(80)},{from:i[8],to:i[9]-.1,color:this.percent2color(90)},{from:i[9],to:s,color:this.percent2color(100)}]}}},dataLabels:{enabled:r},xaxis:{type:"category",categories:["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"]}},this.apex.series=t},findMaximum:function(t){var e=[];return t.forEach((function(t){e.push(Math.max.apply(Math,Object(U["a"])(t.data)))})),Math.max.apply(Math,e)},findMinimum:function(t){var e=[];return t.forEach((function(t){e.push(Math.min.apply(Math,Object(U["a"])(t.data)))})),Math.min.apply(Math,e)},setPercent:function(t,e){for(var a=[],s=Math.floor((t-e)/10),o=1,i=1;o<10;o++)a[o]=e+s*i++;return a},percent2color:function(t){var e,a,s=0;t<40?(a=180,e=Math.round(5.1*t)):t>=40&&t<=50?(a=225,e=Math.round(2*t+155)):(e=255,a=Math.round(510-5.1*t));var o=65536*e+256*a+1*s;return"#"+("000000"+o.toString(16)).slice(-6)},outputCSV:function(t){var e=this,a="";this.output.csv.fileName="heatmap-",t.forEach((function(t){e.output.csv.content+="日期（總度數）,"+t.name+"\r\n時間,度數\r\n",t.data.forEach((function(t,a){e.output.csv.content+=e.apex.chartOptions.xaxis.categories[a]+","+t+"\r\n"})),a=encodeURI(e.output.csv.content)})),this.output.csv.href=this.output.csv.header+a}}},ht=ft,vt=Object(r["a"])(ht,rt,nt,!1,null,"40ce1c72",null),bt=vt.exports,_t=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"ima-ems-header"}},[s("b-container",[s("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"info"}},[s("b-navbar-brand",{attrs:{id:"ima-ems-logo",to:"/real-time"}},[s("img",{attrs:{alt:"ima-logo",src:a("cf05")}}),s("span",{staticClass:"mx-1"},[t._v("今時科技")])]),s("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),s("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[s("b-navbar-nav",[s("b-nav-item",{staticClass:"my-3 text-center",attrs:{to:"real-time"}},[t._v(" 即時用電量 ")]),s("b-nav-item",{staticClass:"my-3 text-center",attrs:{to:"power-consumption"}},[t._v(" 每日用電熱圖 ")]),s("b-nav-item",{staticClass:"my-3 text-center",attrs:{to:"fifteen-demand"}},[t._v(" 每十五分鐘需量 ")]),s("b-nav-item",{staticClass:"my-3 text-center",attrs:{to:"hour-demand"}},[t._v(" 每小時最高需量 ")]),s("b-nav-item",{staticClass:"my-3 text-center",on:{click:t.loginEMS}},[t._v(" 登出系統 ")])],1)],1)],1)],1),s("b-modal",{attrs:{id:"ima-ems-logout",centered:"","hide-footer":"","hide-header":"","body-bg-variant":"dark","no-close-on-backdrop":""}},[s("div",{staticClass:"text-center p-4 rounded-lg"},[s("h4",[t._v("已登出系統，請重新登入")]),s("b-button",{staticClass:"mt-3",attrs:{variant:"info",block:""},on:{click:function(e){return t.$router.push("/")}}},[t._v(" 確認 ")])],1)])],1)},xt=[],gt={name:"TheHeader",methods:{loginEMS:function(){var t=this;this.axios.get(this.$store.state.axios.baseURL+"/api/user/logout").then((function(e){"success"===e.data.status&&(t.$bvModal.show("ima-ems-logout"),document.cookie="login=false;")})).catch((function(t){alert("伺服器錯誤，無法登出："+t)}))}}},At=gt,yt=(a("e19b"),Object(r["a"])(At,_t,xt,!1,null,"2008ca86",null)),Dt=yt.exports;s["default"].use(p["a"]);var Ct=[{path:"/",name:"PageLogin",components:{default:v}},{path:"/real-time",name:"PageRealTime",components:{default:P,nav:Dt}},{path:"/power-consumption",name:"PageRealTime",components:{default:W,nav:Dt}},{path:"/fifteen-demand",name:"PageFifteenDemand",components:{default:it,nav:Dt}},{path:"/hour-demand",name:"PageHourDemand",components:{default:bt,nav:Dt}}],kt=new p["a"]({mode:"history",base:"/",routes:Ct}),wt=kt,Et=a("1321"),Ot=a.n(Et),Mt=a("5f5b"),zt=a("b1e0"),St=(a("f9e3"),a("2dd8"),a("bc3a")),jt=a.n(St),Ft=a("a7fe"),Pt=a.n(Ft),Tt=a("2f62");s["default"].use(Tt["a"]);var Rt=new Tt["a"].Store({state:{axios:{baseURL:"https://demo-site.ima-ems.com"},response:{real_time:Object,heatmap:Object,demand:Object},selected:{date:String}},mutations:{setRealTimeData:function(t,e){t.response.real_time=e},setHeatmapData:function(t,e){t.response.heatmap=e},setDemandData:function(t,e){t.response.demand=e},setSelectedDate:function(t,e){t.selected.date=e}},getters:{RespondedRealTimeData:function(t){return t.response.real_time},RespondedHeatmapData:function(t){return t.response.heatmap},RespondedDemandData:function(t){return t.response.demand},SelectedDate:function(t){return t.selected.date}}});function Ut(t){for(var e=t+"=",a=decodeURIComponent(document.cookie),s=a.split(";"),o=0;o<s.length;o++){var i=s[o];while(" "==i.charAt(0))i=i.substring(1);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return""}jt.a.defaults.withCredentials=!0,s["default"].use(Pt.a,jt.a),s["default"].use(Ot.a),s["default"].use(Mt["a"]),s["default"].use(zt["a"]),s["default"].component("apexchart",Ot.a),s["default"].config.productionTip=!1,wt.beforeEach((function(t,e,a){"true"===Ut("login")?a():"/"!==t.path?a("/"):a()})),new s["default"]({store:Rt,router:wt,render:function(t){return t(c)}}).$mount("#app")},5960:function(t,e,a){"use strict";var s=a("e43f"),o=a.n(s);o.a},"5c0b":function(t,e,a){"use strict";var s=a("9c0c"),o=a.n(s);o.a},"741b":function(t,e){t.exports="data:image/png;base64,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"},"9c0c":function(t,e,a){},cf05:function(t,e,a){t.exports=a.p+"img/logo.78110ab5.png"},e19b:function(t,e,a){"use strict";var s=a("3079"),o=a.n(s);o.a},e43f:function(t,e,a){}});
//# sourceMappingURL=app.94910895.js.map